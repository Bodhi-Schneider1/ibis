<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ibis Academy - Master Math Your Way</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ü¶©</text></svg>">
</head>
<body>
    <!-- Login/Signup Container -->
    <div id="auth-container" class="container">
        <div class="logo-container">
            <div class="logo">ü¶©</div>
            <h1>Ibis Academy</h1>
        </div>
        <p class="tagline">Master algebra, geometry, and trigonometry</p>
        
        <!-- Login Form -->
        <div id="login-form" class="form-section">
            <h2>Login</h2>
            <input type="email" id="login-email" placeholder="Email" required>
            <input type="password" id="login-password" placeholder="Password" required>
            <button onclick="login()">Login</button>
            <p>Don't have an account? <a href="#" onclick="toggleForms()">Sign up</a></p>
<p><a href="#" onclick="resetPassword()">Forgot password?</a></p>
        </div>

        <!-- Signup Form -->
        <div id="signup-form" class="form-section hidden">
            <h2>Sign Up</h2>
            <input type="email" id="signup-email" placeholder="Email" required>
            <input type="password" id="signup-password" placeholder="Password (min 6 characters)" required>
            <button onclick="signup()">Sign Up</button>
            <p>Already have an account? <a href="#" onclick="toggleForms()">Login</a></p>
        </div>

        <p id="error-message" class="error"></p>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboard" class="dashboard-container hidden">
        <!-- Header -->
        <header class="dashboard-header">
            <div class="header-content">
                <div class="logo-header">
                    <span class="logo-emoji">ü¶©</span>
                    <h1>Ibis Academy</h1>
                </div>
                
                <!-- XP and Level Display -->
                <div class="xp-display">
                    <div class="level-badge">
                        <span class="level-label">Level</span>
                        <span class="level-number" id="user-level">1</span>
                    </div>
                    <div class="xp-info">
                        <div class="xp-bar-container">
                            <div class="xp-bar" id="xp-bar"></div>
                        </div>
                        <span class="xp-text"><span id="current-xp">0</span> / <span id="next-level-xp">100</span> XP</span>
                    </div>
                </div>

                <div class="user-menu">
                    <span class="welcome-text">Welcome, <span id="user-name">Student</span>!</span>
                    <button onclick="showProfile()" class="icon-button" title="Profile">üë§</button>
                    <button onclick="showLeaderboard()" class="icon-button" title="Leaderboard">üèÜ</button>
                    <button onclick="logout()" class="icon-button" title="Logout">üö™</button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content" id="main-view">
            <!-- View Toggle -->
            <div class="view-toggle">
                <button class="toggle-btn active" onclick="showLearnView()" id="learn-toggle">
                    üìö Learn
                </button>
                <button class="toggle-btn" onclick="showPracticeView()" id="practice-toggle">
                    ‚úèÔ∏è Practice
                </button>
            </div>

            <!-- Learn View (Lesson Paths) -->
            <div id="learn-view">
                <div class="welcome-section">
                    <h2>Your Learning Paths</h2>
                    <p>Complete lessons in order to unlock new content</p>
                </div>

                <!-- Path Selection -->
                <div class="path-selection">
                    <div class="path-card" onclick="showPath('algebra')">
                        <div class="path-icon">üìê</div>
                        <h3>Algebra Path</h3>
                        <div class="path-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="algebra-progress"></div>
                            </div>
                            <span class="progress-text"><span id="algebra-completed">0</span>/10 completed</span>
                        </div>
                    </div>

                    <div class="path-card" onclick="showPath('geometry')">
                        <div class="path-icon">üìè</div>
                        <h3>Geometry Path</h3>
                        <div class="path-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="geometry-progress"></div>
                            </div>
                            <span class="progress-text"><span id="geometry-completed">0</span>/10 completed</span>
                        </div>
                    </div>

                    <div class="path-card" onclick="showPath('trigonometry')">
                        <div class="path-icon">üìä</div>
                        <h3>Trigonometry Path</h3>
                        <div class="path-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="trigonometry-progress"></div>
                            </div>
                            <span class="progress-text"><span id="trigonometry-completed">0</span>/10 completed</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Practice View -->
            <div id="practice-view" class="hidden">
                <div class="welcome-section">
                    <h2>Practice Your Skills</h2>
                    <p>Sharpen what you've learned with focused drills</p>
                </div>

                <!-- Daily Goal Bar -->
                <div class="daily-goal-bar" id="daily-goal-bar">
                    <div class="dg-left">
                        <span class="dg-flame" id="dg-flame">üî•</span>
                        <div class="dg-info">
                            <strong>Today's Goal</strong>
                            <span id="dg-label">0 / 10 problems</span>
                        </div>
                    </div>
                    <div class="dg-progress-wrap">
                        <div class="dg-progress-bar">
                            <div class="dg-progress-fill" id="dg-progress-fill"></div>
                        </div>
                    </div>
                </div>

                <!-- Action Cards Row -->
                <div class="practice-action-row">
                    <!-- Quick Practice -->
                    <button class="practice-action-card quick-action" onclick="startQuickPractice()" id="quick-practice-btn" disabled>
                        <span class="pac-icon">‚ö°</span>
                        <div class="pac-text">
                            <strong>Quick Practice</strong>
                            <span>10 mixed problems</span>
                        </div>
                        <span class="pac-arrow">‚Üí</span>
                    </button>
                    <!-- Retry Missed -->
                    <button class="practice-action-card retry-action" onclick="startRetryMissed()" id="retry-missed-btn" disabled>
                        <span class="pac-icon">üîÑ</span>
                        <div class="pac-text">
                            <strong>Retry Missed</strong>
                            <span id="retry-missed-label">No missed problems</span>
                        </div>
                        <span class="pac-arrow">‚Üí</span>
                    </button>
                </div>

                <!-- Math Topics -->
                <h3 class="pv-heading">Choose a Topic</h3>
                <div class="topics-grid">
                    <div class="topic-card" onclick="selectTopic('algebra', this)">
                        <div class="topic-card-top">
                            <div class="topic-icon">üìê</div>
                            <div class="mastery-ring" id="algebra-mastery-ring">
                                <svg viewBox="0 0 36 36">
                                    <circle cx="18" cy="18" r="15.915" class="mastery-bg"/>
                                    <circle cx="18" cy="18" r="15.915" class="mastery-fg" id="algebra-mastery-arc" stroke-dasharray="0 100"/>
                                </svg>
                                <span class="mastery-pct" id="algebra-mastery-pct">‚Äî</span>
                            </div>
                        </div>
                        <h3>Algebra</h3>
                        <p>Equations, expressions, and functions</p>
                        <div class="topic-stats">
                            <span class="stat">üéØ <span id="algebra-practice-count">0</span> correct</span>
                            <span class="stat">üìä <span id="algebra-total-count">0</span> attempted</span>
                        </div>
                    </div>

                    <div class="topic-card" onclick="selectTopic('geometry', this)">
                        <div class="topic-card-top">
                            <div class="topic-icon">üìè</div>
                            <div class="mastery-ring" id="geometry-mastery-ring">
                                <svg viewBox="0 0 36 36">
                                    <circle cx="18" cy="18" r="15.915" class="mastery-bg"/>
                                    <circle cx="18" cy="18" r="15.915" class="mastery-fg" id="geometry-mastery-arc" stroke-dasharray="0 100"/>
                                </svg>
                                <span class="mastery-pct" id="geometry-mastery-pct">‚Äî</span>
                            </div>
                        </div>
                        <h3>Geometry</h3>
                        <p>Shapes, angles, and spatial reasoning</p>
                        <div class="topic-stats">
                            <span class="stat">üéØ <span id="geometry-practice-count">0</span> correct</span>
                            <span class="stat">üìä <span id="geometry-total-count">0</span> attempted</span>
                        </div>
                    </div>

                    <div class="topic-card" onclick="selectTopic('trigonometry', this)">
                        <div class="topic-card-top">
                            <div class="topic-icon">üìä</div>
                            <div class="mastery-ring" id="trigonometry-mastery-ring">
                                <svg viewBox="0 0 36 36">
                                    <circle cx="18" cy="18" r="15.915" class="mastery-bg"/>
                                    <circle cx="18" cy="18" r="15.915" class="mastery-fg" id="trigonometry-mastery-arc" stroke-dasharray="0 100"/>
                                </svg>
                                <span class="mastery-pct" id="trigonometry-mastery-pct">‚Äî</span>
                            </div>
                        </div>
                        <h3>Trigonometry</h3>
                        <p>Sine, cosine, and triangle relationships</p>
                        <div class="topic-stats">
                            <span class="stat">üéØ <span id="trigonometry-practice-count">0</span> correct</span>
                            <span class="stat">üìä <span id="trigonometry-total-count">0</span> attempted</span>
                        </div>
                    </div>
                </div>

                <!-- Subtopic Chips (appears after topic chosen) -->
                <div class="subtopic-section hidden" id="subtopic-section">
                    <h3 class="pv-heading">Focus Area <span class="optional-tag">optional ‚Äî leave blank for all topics</span></h3>
                    <div class="subtopic-chips" id="subtopic-chips"></div>
                </div>

                <!-- Practice Settings Row (appears after topic chosen) -->
                <div class="practice-settings hidden" id="practice-settings">
                    <div class="setting-group">
                        <label class="setting-label">Mode</label>
                        <div class="mode-buttons">
                            <button class="mode-button active" onclick="setPracticeMode('regular', event)">
                                <span class="mode-icon">üìù</span>
                                <span class="mode-label">Regular</span>
                                <span class="mode-desc">+10 XP each</span>
                            </button>
                            <button class="mode-button" onclick="setPracticeMode('timed', event)">
                                <span class="mode-icon">‚è±Ô∏è</span>
                                <span class="mode-label">Timed</span>
                                <span class="mode-desc">+15 XP each</span>
                            </button>
                        </div>
                    </div>
                    <div class="setting-group">
                        <label class="setting-label">Problems</label>
                        <div class="count-buttons">
                            <button class="count-btn" onclick="setProblemCount(5, event)">5</button>
                            <button class="count-btn active" onclick="setProblemCount(10, event)">10</button>
                            <button class="count-btn" onclick="setProblemCount(15, event)">15</button>
                            <button class="count-btn" onclick="setProblemCount(20, event)">20</button>
                        </div>
                    </div>
                </div>

                <!-- Start Button (appears after topic chosen) -->
                <div class="start-section hidden" id="start-section">
                    <button class="start-button" onclick="startPractice()" id="start-btn">
                        Start Practice
                    </button>
                </div>
            </div>
        </main>

        <!-- Lesson Path View -->
        <div class="path-view hidden" id="path-view">
            <div class="path-container">
                <button class="back-button" onclick="showDashboard()">‚Üê Back to Paths</button>
                
                <div class="path-header">
                    <div class="path-icon-large" id="path-icon"></div>
                    <h2 id="path-title">Algebra Path</h2>
                    <p class="path-subtitle">Complete lessons in order to progress</p>
                </div>

                <div class="lesson-path" id="lesson-path">
                    <!-- Lesson nodes will be generated here -->
                </div>
            </div>
        </div>

        <!-- Lesson Viewer -->
        <div class="lesson-viewer hidden" id="lesson-viewer">
            <div class="lesson-container">
                <button class="back-button" onclick="closeLessonToPath()">‚Üê Back to Path</button>
                
                <div class="lesson-header">
                    <span class="lesson-topic-badge" id="lesson-topic-badge"></span>
                    <h1 id="lesson-title">Lesson Title</h1>
                    <p class="lesson-subtitle" id="lesson-subtitle">Lesson description</p>
                </div>

                <div class="lesson-content" id="lesson-content">
                    <!-- Lesson content will be loaded here -->
                </div>

                <div class="lesson-footer">
                    <button onclick="closeLessonToPath()" class="secondary-button">Back to Path</button>
                    <button onclick="completeLesson()" class="primary-button" id="complete-lesson-btn">Complete Lesson</button>
                </div>
            </div>
        </div>

        <!-- Profile View -->
        <div class="profile-view hidden" id="profile-view">
            <div class="profile-container">
                <button class="back-button" onclick="showDashboard()">‚Üê Back to Dashboard</button>
                
                <h2>Your Profile</h2>
                
                <!-- Profile Display -->
                <div id="profile-display" class="profile-section">
                    <div class="profile-header">
                        <img id="profile-img" src="" alt="Profile Picture" class="profile-picture">
                        <div class="profile-info">
                            <h3 id="display-name">Loading...</h3>
                            <p class="email-text"><span id="display-email"></span></p>
                            <div class="profile-stats">
                                <div class="stat-item">
                                    <span class="stat-icon">‚≠ê</span>
                                    <span class="stat-value" id="profile-xp">0 XP</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-icon">üìö</span>
                                    <span class="stat-value" id="profile-lessons">0 lessons</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-icon">üèÜ</span>
                                    <span class="stat-value" id="profile-badges">0 badges</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Badges Section -->
                    <div class="badges-section">
                        <h4>üèÜ Achievements</h4>
                        <div class="badges-grid" id="badges-grid">
                            <!-- Badges will be loaded here -->
                        </div>
                    </div>

                    <div class="profile-bio">
                        <h4>Bio</h4>
                        <p id="display-bio">No bio set</p>
                    </div>
                    <button onclick="toggleEditMode()" class="secondary-button">Edit Profile</button>
                </div>

                <!-- Profile Edit -->
                <div id="profile-edit" class="profile-section hidden">
                    <h3>Edit Your Profile</h3>
                    <div class="form-section">
                        <label for="profile-name">Display Name</label>
                        <input type="text" id="profile-name" placeholder="Your name">
                        
                        <label for="profile-bio">Bio</label>
                        <textarea id="profile-bio" placeholder="Tell us about yourself..." rows="4"></textarea>
                        
                        <label for="profile-picture">Profile Picture URL</label>
                        <input type="url" id="profile-picture" placeholder="https://example.com/your-image.jpg">
                        <p class="help-text">Paste a link to an image</p>
                        
                        <div class="button-group">
                            <button onclick="saveProfile()">Save Profile</button>
                            <button onclick="toggleEditMode()" class="secondary-button">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Leaderboard View -->
        <div class="leaderboard-view hidden" id="leaderboard-view">
            <div class="leaderboard-container">
                <button class="back-button" onclick="showDashboard()">‚Üê Back to Dashboard</button>
                
                <h2>üèÜ Leaderboard</h2>
                <p class="leaderboard-subtitle">Top students this week</p>

                <div class="leaderboard-list" id="leaderboard-list">
                    <div class="loading-message">Loading leaderboard...</div>
                </div>
            </div>
        </div>

        <!-- Practice Session View -->
        <div class="practice-session hidden" id="practice-session">
            <div class="practice-session-container">
                <!-- Session Header -->
                <div class="session-header">
                    <div class="session-info">
                        <span class="session-badge" id="session-topic"></span>
                        <span class="session-badge session-diff-badge" id="session-difficulty"></span>
                    </div>
                    <div class="session-progress-section">
                        <span id="session-progress-text">Problem 1 of 5</span>
                        <div class="session-progress-bar">
                            <div class="session-progress-fill" id="session-progress-fill"></div>
                        </div>
                    </div>
                    <div class="session-header-right">
                        <div class="session-streak hidden" id="session-streak">
                            <span class="streak-fire">üî•</span>
                            <span class="streak-count" id="streak-count">0</span>
                        </div>
                        <div class="session-score-display">
                            Score: <strong id="session-score">0</strong> / <span id="session-total">5</span>
                        </div>
                        <div class="session-timer hidden" id="session-timer">
                            <span class="timer-icon">‚è±Ô∏è</span>
                            <span class="timer-value" id="timer-value">30</span>s
                        </div>
                    </div>
                </div>
                <!-- XP Float -->
                <div class="xp-float hidden" id="xp-float">+10 XP</div>

                <!-- Problem Area -->
                <div class="problem-area" id="problem-area">
                    <div class="problem-question" id="problem-question"></div>
                    <div class="problem-choices" id="problem-choices"></div>
                </div>

                <!-- Feedback Area (hidden until answered) -->
                <div class="feedback-area hidden" id="feedback-area">
                    <div class="feedback-banner" id="feedback-banner">
                        <span class="feedback-icon" id="feedback-icon"></span>
                        <span class="feedback-text" id="feedback-text"></span>
                    </div>
                    <div class="feedback-explanation" id="feedback-explanation"></div>
                </div>

                <!-- Session Actions -->
                <div class="session-actions">
                    <button class="next-btn hidden" id="next-problem-btn" onclick="nextProblem()">
                        Next Problem ‚Üí
                    </button>
                    <button class="quit-btn" id="quit-btn" onclick="quitSession()">
                        ‚úï Quit
                    </button>
                </div>
            </div>
        </div>

        <!-- Session Summary View -->
        <div class="session-summary hidden" id="session-summary">
            <div class="summary-container">
                <div class="summary-icon" id="summary-icon">üéâ</div>
                <h2 id="summary-title">Session Complete!</h2>
                <p class="summary-subtitle" id="summary-subtitle"></p>

                <div class="summary-stats">
                    <div class="summary-stat">
                        <span class="summary-stat-value" id="summary-correct">0</span>
                        <span class="summary-stat-label">Correct</span>
                    </div>
                    <div class="summary-stat">
                        <span class="summary-stat-value" id="summary-total-problems">5</span>
                        <span class="summary-stat-label">Problems</span>
                    </div>
                    <div class="summary-stat">
                        <span class="summary-stat-value" id="summary-accuracy">0%</span>
                        <span class="summary-stat-label">Accuracy</span>
                    </div>
                    <div class="summary-stat xp-stat">
                        <span class="summary-stat-value" id="summary-xp">+0 XP</span>
                        <span class="summary-stat-label">Earned</span>
                    </div>
                    <div class="summary-stat streak-stat hidden" id="summary-streak-stat">
                        <span class="summary-stat-value" id="summary-best-streak">0</span>
                        <span class="summary-stat-label">üî• Best Streak</span>
                    </div>
                </div>

                <!-- Per-problem review (expandable) -->
                <div class="summary-review">
                    <h3 class="review-heading" id="review-heading">Problem Review ‚Äî tap to see explanations</h3>
                    <div class="summary-breakdown" id="summary-breakdown"></div>
                </div>

                <div class="summary-actions">
                    <button onclick="startRetryMissedFromSummary()" class="retry-summary-btn hidden" id="retry-summary-btn">üîÑ Retry Missed Problems</button>
                    <button onclick="practiceAgain()">Practice Again</button>
                    <button onclick="backToDashboardFromSummary()" class="secondary-button">Back to Dashboard</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module" src="app.js"></script>
</body>
</html>
