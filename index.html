<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ibis Academy - Master Math Your Way</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='https://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ü¶©</text></svg>">
</head>
<body>
    <!-- Login/Signup Container -->
    <div id="auth-container" class="container">
        <div class="logo-container">
            <div class="logo">ü¶©</div>
            <h1>Ibis Academy</h1>
        </div>
        <p class="tagline">Master math from pre-algebra to calculus</p>
        
        <!-- Login Form -->
        <div id="login-form" class="form-section">
            <h2>Login</h2>
            <input type="email" id="login-email" placeholder="Email" required>
            <input type="password" id="login-password" placeholder="Password" required>
            <button onclick="login()">Login</button>
            <div class="auth-divider"><span>or</span></div>
            <button class="google-btn" onclick="signInWithGoogle()">
                <svg class="google-icon" viewBox="0 0 24 24" width="18" height="18"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                Sign in with Google
            </button>
            <p>Don't have an account? <a href="#" onclick="toggleForms()">Sign up</a></p>
<p><a href="#" onclick="resetPassword()">Forgot password?</a></p>
        </div>

        <!-- Signup Form -->
        <div id="signup-form" class="form-section hidden">
            <h2>Sign Up</h2>
            <input type="email" id="signup-email" placeholder="Email" required>
            <input type="password" id="signup-password" placeholder="Password (min 6 characters)" required>
            <button onclick="signup()">Sign Up</button>
            <div class="auth-divider"><span>or</span></div>
            <button class="google-btn" onclick="signInWithGoogle()">
                <svg class="google-icon" viewBox="0 0 24 24" width="18" height="18"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                Sign up with Google
            </button>
            <p>Already have an account? <a href="#" onclick="toggleForms()">Login</a></p>
        </div>

        <p id="error-message" class="error"></p>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboard" class="dashboard-container hidden">
        <!-- Header -->
        <header class="dashboard-header">
            <div class="header-content">
                <div class="logo-header">
                    <span class="logo-emoji">ü¶©</span>
                    <h1>Ibis Academy</h1>
                </div>
                
                <!-- XP and Level Display -->
                <div class="xp-display">
                    <div class="level-badge">
                        <span class="level-label">Level</span>
                        <span class="level-number" id="user-level">1</span>
                    </div>
                    <div class="xp-info">
                        <div class="xp-bar-container">
                            <div class="xp-bar" id="xp-bar"></div>
                        </div>
                        <span class="xp-text"><span id="current-xp">0</span> / <span id="next-level-xp">100</span> XP</span>
                    </div>
                </div>

                <div class="user-menu">
                    <span class="welcome-text">Welcome, <span id="user-name">Student</span>!</span>
                    <button onclick="showProfile()" class="icon-button" title="Profile">üë§</button>
                    <button onclick="showLeaderboard()" class="icon-button" title="Leaderboard">üèÜ</button>
                    <button onclick="logout()" class="icon-button" title="Logout">üö™</button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content" id="main-view">
            <!-- View Toggle -->
            <div class="view-toggle">
                <button class="toggle-btn active" onclick="showLearnView()" id="learn-toggle">
                    üìö Learn
                </button>
                <button class="toggle-btn" onclick="showPracticeView()" id="practice-toggle">
                    ‚úèÔ∏è Practice
                </button>
            </div>

            <!-- Learn View (Lesson Paths) -->
            <div id="learn-view">
                <div class="welcome-section">
                    <h2>Your Learning Paths</h2>
                    <p>Complete lessons in order to unlock new content</p>
                </div>

                <!-- Path Selection -->
                <div class="path-selection">
                    <div class="path-card" onclick="showPath('algebra')">
                        <div class="path-icon">üìê</div>
                        <h3>Algebra Path</h3>
                        <div class="path-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="algebra-progress"></div>
                            </div>
                            <span class="progress-text"><span id="algebra-completed">0</span>/10 completed</span>
                        </div>
                    </div>

                    <div class="path-card" onclick="showPath('geometry')">
                        <div class="path-icon">üìè</div>
                        <h3>Geometry Path</h3>
                        <div class="path-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="geometry-progress"></div>
                            </div>
                            <span class="progress-text"><span id="geometry-completed">0</span>/10 completed</span>
                        </div>
                    </div>

                    <div class="path-card" onclick="showPath('trigonometry')">
                        <div class="path-icon">üìä</div>
                        <h3>Trigonometry Path</h3>
                        <div class="path-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="trigonometry-progress"></div>
                            </div>
                            <span class="progress-text"><span id="trigonometry-completed">0</span>/10 completed</span>
                        </div>
                    </div>

                    <div class="path-card" onclick="showPath('prealgebra')">
                        <div class="path-icon">üî¢</div>
                        <h3>Pre-Algebra Path</h3>
                        <div class="path-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="prealgebra-progress"></div>
                            </div>
                            <span class="progress-text"><span id="prealgebra-completed">0</span>/10 completed</span>
                        </div>
                    </div>

                    <div class="path-card" onclick="showPath('statistics')">
                        <div class="path-icon">üìà</div>
                        <h3>Statistics Path</h3>
                        <div class="path-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="statistics-progress"></div>
                            </div>
                            <span class="progress-text"><span id="statistics-completed">0</span>/10 completed</span>
                        </div>
                    </div>

                    <div class="path-card" onclick="showPath('calculus')">
                        <div class="path-icon">‚à´</div>
                        <h3>Calculus Path</h3>
                        <div class="path-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="calculus-progress"></div>
                            </div>
                            <span class="progress-text"><span id="calculus-completed">0</span>/10 completed</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Practice View -->
            <div id="practice-view" class="hidden">
                <div class="welcome-section">
                    <h2>Practice Your Skills</h2>
                    <p>Sharpen what you've learned with focused drills</p>
                </div>

                <!-- Daily Goal Bar -->
                <div class="daily-goal-bar" id="daily-goal-bar">
                    <div class="dg-left">
                        <span class="dg-flame" id="dg-flame">üî•</span>
                        <div class="dg-info">
                            <strong>Today's Goal</strong>
                            <span id="dg-label">0 / 10 problems</span>
                        </div>
                    </div>
                    <div class="dg-progress-wrap">
                        <div class="dg-progress-bar">
                            <div class="dg-progress-fill" id="dg-progress-fill"></div>
                        </div>
                    </div>
                </div>

                <!-- Action Cards Row -->
                <div class="practice-action-row">
                    <!-- Quick Practice -->
                    <button class="practice-action-card quick-action" onclick="startQuickPractice()" id="quick-practice-btn" disabled>
                        <span class="pac-icon">‚ö°</span>
                        <div class="pac-text">
                            <strong>Quick Practice</strong>
                            <span>10 mixed problems</span>
                        </div>
                        <span class="pac-arrow">‚Üí</span>
                    </button>
                    <!-- Retry Missed -->
                    <button class="practice-action-card retry-action" onclick="startRetryMissed()" id="retry-missed-btn" disabled>
                        <span class="pac-icon">üîÑ</span>
                        <div class="pac-text">
                            <strong>Retry Missed</strong>
                            <span id="retry-missed-label">No missed problems</span>
                        </div>
                        <span class="pac-arrow">‚Üí</span>
                    </button>
                </div>

                <!-- Math Topics -->
                <h3 class="pv-heading">Choose a Topic</h3>
                <div class="topics-grid">
                    <div class="topic-card" onclick="selectTopic('algebra', this)">
                        <div class="topic-card-top">
                            <div class="topic-icon">üìê</div>
                            <div class="mastery-ring" id="algebra-mastery-ring">
                                <svg viewBox="0 0 36 36">
                                    <circle cx="18" cy="18" r="15.915" class="mastery-bg"/>
                                    <circle cx="18" cy="18" r="15.915" class="mastery-fg" id="algebra-mastery-arc" stroke-dasharray="0 100"/>
                                </svg>
                                <span class="mastery-pct" id="algebra-mastery-pct">‚Äî</span>
                            </div>
                        </div>
                        <h3>Algebra</h3>
                        <p>Equations, expressions, and functions</p>
                        <div class="topic-stats">
                            <span class="stat">üéØ <span id="algebra-practice-count">0</span> correct</span>
                            <span class="stat">üìä <span id="algebra-total-count">0</span> attempted</span>
                        </div>
                    </div>

                    <div class="topic-card" onclick="selectTopic('geometry', this)">
                        <div class="topic-card-top">
                            <div class="topic-icon">üìè</div>
                            <div class="mastery-ring" id="geometry-mastery-ring">
                                <svg viewBox="0 0 36 36">
                                    <circle cx="18" cy="18" r="15.915" class="mastery-bg"/>
                                    <circle cx="18" cy="18" r="15.915" class="mastery-fg" id="geometry-mastery-arc" stroke-dasharray="0 100"/>
                                </svg>
                                <span class="mastery-pct" id="geometry-mastery-pct">‚Äî</span>
                            </div>
                        </div>
                        <h3>Geometry</h3>
                        <p>Shapes, angles, and spatial reasoning</p>
                        <div class="topic-stats">
                            <span class="stat">üéØ <span id="geometry-practice-count">0</span> correct</span>
                            <span class="stat">üìä <span id="geometry-total-count">0</span> attempted</span>
                        </div>
                    </div>

                    <div class="topic-card" onclick="selectTopic('trigonometry', this)">
                        <div class="topic-card-top">
                            <div class="topic-icon">üìä</div>
                            <div class="mastery-ring" id="trigonometry-mastery-ring">
                                <svg viewBox="0 0 36 36">
                                    <circle cx="18" cy="18" r="15.915" class="mastery-bg"/>
                                    <circle cx="18" cy="18" r="15.915" class="mastery-fg" id="trigonometry-mastery-arc" stroke-dasharray="0 100"/>
                                </svg>
                                <span class="mastery-pct" id="trigonometry-mastery-pct">‚Äî</span>
                            </div>
                        </div>
                        <h3>Trigonometry</h3>
                        <p>Sine, cosine, and triangle relationships</p>
                        <div class="topic-stats">
                            <span class="stat">üéØ <span id="trigonometry-practice-count">0</span> correct</span>
                            <span class="stat">üìä <span id="trigonometry-total-count">0</span> attempted</span>
                        </div>
                    </div>

                    <div class="topic-card" onclick="selectTopic('prealgebra', this)">
                        <div class="topic-card-top">
                            <div class="topic-icon">üî¢</div>
                            <div class="mastery-ring" id="prealgebra-mastery-ring">
                                <svg viewBox="0 0 36 36">
                                    <circle cx="18" cy="18" r="15.915" class="mastery-bg"/>
                                    <circle cx="18" cy="18" r="15.915" class="mastery-fg" id="prealgebra-mastery-arc" stroke-dasharray="0 100"/>
                                </svg>
                                <span class="mastery-pct" id="prealgebra-mastery-pct">‚Äî</span>
                            </div>
                        </div>
                        <h3>Pre-Algebra</h3>
                        <p>Fractions, decimals, ratios, and integers</p>
                        <div class="topic-stats">
                            <span class="stat">üéØ <span id="prealgebra-practice-count">0</span> correct</span>
                            <span class="stat">üìä <span id="prealgebra-total-count">0</span> attempted</span>
                        </div>
                    </div>

                    <div class="topic-card" onclick="selectTopic('statistics', this)">
                        <div class="topic-card-top">
                            <div class="topic-icon">üìà</div>
                            <div class="mastery-ring" id="statistics-mastery-ring">
                                <svg viewBox="0 0 36 36">
                                    <circle cx="18" cy="18" r="15.915" class="mastery-bg"/>
                                    <circle cx="18" cy="18" r="15.915" class="mastery-fg" id="statistics-mastery-arc" stroke-dasharray="0 100"/>
                                </svg>
                                <span class="mastery-pct" id="statistics-mastery-pct">‚Äî</span>
                            </div>
                        </div>
                        <h3>Statistics</h3>
                        <p>Data, probability, and distributions</p>
                        <div class="topic-stats">
                            <span class="stat">üéØ <span id="statistics-practice-count">0</span> correct</span>
                            <span class="stat">üìä <span id="statistics-total-count">0</span> attempted</span>
                        </div>
                    </div>

                    <div class="topic-card" onclick="selectTopic('calculus', this)">
                        <div class="topic-card-top">
                            <div class="topic-icon">‚à´</div>
                            <div class="mastery-ring" id="calculus-mastery-ring">
                                <svg viewBox="0 0 36 36">
                                    <circle cx="18" cy="18" r="15.915" class="mastery-bg"/>
                                    <circle cx="18" cy="18" r="15.915" class="mastery-fg" id="calculus-mastery-arc" stroke-dasharray="0 100"/>
                                </svg>
                                <span class="mastery-pct" id="calculus-mastery-pct">‚Äî</span>
                            </div>
                        </div>
                        <h3>Calculus</h3>
                        <p>Limits, derivatives, and integrals</p>
                        <div class="topic-stats">
                            <span class="stat">üéØ <span id="calculus-practice-count">0</span> correct</span>
                            <span class="stat">üìä <span id="calculus-total-count">0</span> attempted</span>
                        </div>
                    </div>
                </div>

                <!-- Subtopic Chips (appears after topic chosen) -->
                <div class="subtopic-section hidden" id="subtopic-section">
                    <h3 class="pv-heading">Focus Area <span class="optional-tag">optional ‚Äî leave blank for all topics</span></h3>
                    <div class="subtopic-chips" id="subtopic-chips"></div>
                </div>

                <!-- Practice Settings Row (appears after topic chosen) -->
                <div class="practice-settings hidden" id="practice-settings">
                    <div class="setting-group">
                        <label class="setting-label">Mode</label>
                        <div class="mode-buttons">
                            <button class="mode-button active" onclick="setPracticeMode('regular', event)">
                                <span class="mode-icon">üìù</span>
                                <span class="mode-label">Regular</span>
                                <span class="mode-desc">+10 XP each</span>
                            </button>
                            <button class="mode-button" onclick="setPracticeMode('timed', event)">
                                <span class="mode-icon">‚è±Ô∏è</span>
                                <span class="mode-label">Timed</span>
                                <span class="mode-desc">+15 XP each</span>
                            </button>
                        </div>
                    </div>
                    <div class="setting-group">
                        <label class="setting-label">Problems</label>
                        <div class="count-buttons">
                            <button class="count-btn" onclick="setProblemCount(5, event)">5</button>
                            <button class="count-btn active" onclick="setProblemCount(10, event)">10</button>
                            <button class="count-btn" onclick="setProblemCount(15, event)">15</button>
                            <button class="count-btn" onclick="setProblemCount(20, event)">20</button>
                        </div>
                    </div>
                </div>

                <!-- Start Button (appears after topic chosen) -->
                <div class="start-section hidden" id="start-section">
                    <button class="start-button" onclick="startPractice()" id="start-btn">
                        Start Practice
                    </button>
                </div>
            </div>
        </main>

        <!-- Lesson Path View -->
        <div class="path-view hidden" id="path-view">
            <div class="path-container">
                <button class="back-button" onclick="showDashboard()">‚Üê Back to Paths</button>
                
                <div class="path-header">
                    <div class="path-icon-large" id="path-icon"></div>
                    <h2 id="path-title">Algebra Path</h2>
                    <p class="path-subtitle">Complete lessons in order to progress</p>
                </div>

                <div class="lesson-path" id="lesson-path">
                    <!-- Lesson nodes will be generated here -->
                </div>
            </div>
        </div>

        <!-- Lesson Viewer -->
        <div class="lesson-viewer hidden" id="lesson-viewer">
            <div class="lesson-container">
                <button class="back-button" onclick="closeLessonToPath()">‚Üê Back to Path</button>
                
                <div class="lesson-header">
                    <span class="lesson-topic-badge" id="lesson-topic-badge"></span>
                    <h1 id="lesson-title">Lesson Title</h1>
                    <p class="lesson-subtitle" id="lesson-subtitle">Lesson description</p>
                </div>

                <div class="lesson-content" id="lesson-content">
                    <!-- Lesson content will be loaded here -->
                </div>

                <div class="lesson-footer">
                    <button onclick="closeLessonToPath()" class="secondary-button">Back to Path</button>
                    <button onclick="completeLesson()" class="primary-button" id="complete-lesson-btn">Complete Lesson</button>
                </div>
            </div>
        </div>

        <!-- Profile View -->
        <div class="profile-view hidden" id="profile-view">
            <div class="profile-container">
                <button class="back-button" onclick="showDashboard()">‚Üê Back to Dashboard</button>
                
                <h2>Your Profile</h2>
                
                <!-- Profile Display -->
                <div id="profile-display" class="profile-section">
                    <div class="profile-header">
                        <img id="profile-img" src="" alt="Profile Picture" class="profile-picture">
                        <div class="profile-info">
                            <h3 id="display-name">Loading...</h3>
                            <p class="email-text"><span id="display-email"></span></p>
                            <div class="profile-stats">
                                <div class="stat-item">
                                    <span class="stat-icon">‚≠ê</span>
                                    <span class="stat-value" id="profile-xp">0 XP</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-icon">üìö</span>
                                    <span class="stat-value" id="profile-lessons">0 lessons</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-icon">üèÜ</span>
                                    <span class="stat-value" id="profile-badges">0 badges</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Badges Section -->
                    <div class="badges-section">
                        <h4>üèÜ Achievements</h4>
                        <div class="badges-grid" id="badges-grid">
                            <!-- Badges will be loaded here -->
                        </div>
                    </div>

                    <div class="profile-bio">
                        <h4>Bio</h4>
                        <p id="display-bio">No bio set</p>
                    </div>
                    <button onclick="toggleEditMode()" class="secondary-button">Edit Profile</button>
                </div>

                <!-- Profile Edit -->
                <div id="profile-edit" class="profile-section hidden">
                    <h3>Edit Your Profile</h3>
                    <div class="form-section">
                        <label for="profile-name">Display Name</label>
                        <input type="text" id="profile-name" placeholder="Your name">
                        
                        <label for="profile-bio">Bio</label>
                        <textarea id="profile-bio" placeholder="Tell us about yourself..." rows="4"></textarea>
                        
                        <label for="profile-picture">Profile Picture URL</label>
                        <input type="url" id="profile-picture" placeholder="https://example.com/your-image.jpg">
                        <p class="help-text">Paste a link to an image</p>
                        
                        <div class="button-group">
                            <button onclick="saveProfile()">Save Profile</button>
                            <button onclick="toggleEditMode()" class="secondary-button">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Leaderboard View -->
        <div class="leaderboard-view hidden" id="leaderboard-view">
            <div class="leaderboard-container">
                <button class="back-button" onclick="showDashboard()">‚Üê Back to Dashboard</button>
                
                <h2>üèÜ Leaderboard</h2>
                <div class="lb-tabs">
                    <button class="lb-tab active" id="lb-tab-weekly" onclick="switchLeaderboard('weekly')">This Week</button>
                    <button class="lb-tab" id="lb-tab-alltime" onclick="switchLeaderboard('alltime')">All Time</button>
                </div>
                <p class="leaderboard-subtitle" id="lb-subtitle">Top students this week</p>
                <div class="lb-reset-timer" id="lb-reset-timer"></div>

                <div class="leaderboard-list" id="leaderboard-list">
                    <div class="loading-message">Loading leaderboard...</div>
                </div>

                <!-- Friend Challenges -->
                <div class="friend-challenge-section">
                    <h3>‚öîÔ∏è Friend Challenge</h3>
                    <p class="fc-desc">Challenge a friend to a timed quiz! Share your code or enter theirs.</p>
                    <div class="fc-actions">
                        <button class="fc-btn fc-create" onclick="createChallenge()">üéØ Create Challenge</button>
                        <div class="fc-join-row">
                            <input type="text" id="fc-join-code" placeholder="Enter challenge code" maxlength="8">
                            <button class="fc-btn fc-join" onclick="joinChallenge()">Join</button>
                        </div>
                    </div>
                    <div class="fc-status hidden" id="fc-status"></div>
                    <div class="fc-active-list" id="fc-active-list"></div>
                </div>
            </div>
        </div>

        <!-- Practice Session View -->
        <div class="practice-session hidden" id="practice-session">
            <div class="practice-session-container">
                <!-- Session Header -->
                <div class="session-header">
                    <div class="session-info">
                        <span class="session-badge" id="session-topic"></span>
                        <span class="session-badge session-diff-badge" id="session-difficulty"></span>
                    </div>
                    <div class="session-progress-section">
                        <span id="session-progress-text">Problem 1 of 5</span>
                        <div class="session-progress-bar">
                            <div class="session-progress-fill" id="session-progress-fill"></div>
                        </div>
                    </div>
                    <div class="session-header-right">
                        <div class="session-streak hidden" id="session-streak">
                            <span class="streak-fire">üî•</span>
                            <span class="streak-count" id="streak-count">0</span>
                        </div>
                        <div class="session-score-display">
                            Score: <strong id="session-score">0</strong> / <span id="session-total">5</span>
                        </div>
                        <div class="session-timer hidden" id="session-timer">
                            <span class="timer-icon">‚è±Ô∏è</span>
                            <span class="timer-value" id="timer-value">30</span>s
                        </div>
                    </div>
                </div>
                <!-- XP Float -->
                <div class="xp-float hidden" id="xp-float">+10 XP</div>

                <!-- Problem Area -->
                <div class="problem-area" id="problem-area">
                    <div class="problem-question" id="problem-question"></div>
                    <div class="problem-choices" id="problem-choices"></div>
                </div>

                <!-- Feedback Area (hidden until answered) -->
                <div class="feedback-area hidden" id="feedback-area">
                    <div class="feedback-banner" id="feedback-banner">
                        <span class="feedback-icon" id="feedback-icon"></span>
                        <span class="feedback-text" id="feedback-text"></span>
                    </div>
                    <div class="feedback-explanation" id="feedback-explanation"></div>
                </div>

                <!-- Session Actions -->
                <div class="session-actions">
                    <button class="next-btn hidden" id="next-problem-btn" onclick="nextProblem()">
                        Next Problem ‚Üí
                    </button>
                    <button class="quit-btn" id="quit-btn" onclick="quitSession()">
                        ‚úï Quit
                    </button>
                </div>
            </div>
        </div>

        <!-- Session Summary View -->
        <div class="session-summary hidden" id="session-summary">
            <div class="summary-container">
                <div class="summary-icon" id="summary-icon">üéâ</div>
                <h2 id="summary-title">Session Complete!</h2>
                <p class="summary-subtitle" id="summary-subtitle"></p>

                <div class="summary-stats">
                    <div class="summary-stat">
                        <span class="summary-stat-value" id="summary-correct">0</span>
                        <span class="summary-stat-label">Correct</span>
                    </div>
                    <div class="summary-stat">
                        <span class="summary-stat-value" id="summary-total-problems">5</span>
                        <span class="summary-stat-label">Problems</span>
                    </div>
                    <div class="summary-stat">
                        <span class="summary-stat-value" id="summary-accuracy">0%</span>
                        <span class="summary-stat-label">Accuracy</span>
                    </div>
                    <div class="summary-stat xp-stat">
                        <span class="summary-stat-value" id="summary-xp">+0 XP</span>
                        <span class="summary-stat-label">Earned</span>
                    </div>
                    <div class="summary-stat streak-stat hidden" id="summary-streak-stat">
                        <span class="summary-stat-value" id="summary-best-streak">0</span>
                        <span class="summary-stat-label">üî• Best Streak</span>
                    </div>
                </div>

                <!-- Per-problem review (expandable) -->
                <div class="summary-review">
                    <h3 class="review-heading" id="review-heading">Problem Review ‚Äî tap to see explanations</h3>
                    <div class="summary-breakdown" id="summary-breakdown"></div>
                </div>

                <div class="summary-actions">
                    <button onclick="startRetryMissedFromSummary()" class="retry-summary-btn hidden" id="retry-summary-btn">üîÑ Retry Missed Problems</button>
                    <button onclick="practiceAgain()">Practice Again</button>
                    <button onclick="backToDashboardFromSummary()" class="secondary-button">Back to Dashboard</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Confetti Canvas -->
    <canvas id="confetti-canvas"></canvas>

    <!-- Firebase SDK -->
    <script type="module" src="app.js"></script>
</body>
</html>
